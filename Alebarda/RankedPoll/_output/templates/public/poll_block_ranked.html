<xf:title>{{ $poll.question }}</xf:title>

<div class="block">
	<div class="block-container">
		<div class="block-body">

			<xf:if is="$poll.hasVoted()">
				<div class="blockMessage blockMessage--important blockMessage--iconic">
					<xf:if is="$poll.change_vote">
						Вы уже проголосовали. Вы можете изменить свой голос ниже.
					<xf:else />
						Вы уже проголосовали и не можете изменить свой голос.
					</xf:if>
				</div>
			</xf:if>

			<xf:if is="$poll.canVote()">
				<div class="blockMessage blockMessage--info blockMessage--iconic">
					<strong>Ranked-choice голосование (Метод Шульце)</strong><br />
					Проранжируйте варианты от наиболее предпочитаемого к наименее предпочитаемому.
					Вам не обязательно ранжировать все варианты.
				</div>

				<form action="{{ link('ranked-polls/vote', $poll) }}" method="post" class="block">
					<div class="block-body">
						<xf:foreach loop="$poll.Responses" value="$response">
							<xf:set var="$currentRank" value="{$userRankedVotes.{$response.poll_response_id}}" />

							<dl class="inputPair">
								<dt>
									<div class="inputLabel">
										{{ $response.response }}
									</div>
								</dt>
								<dd>
									<select name="rankings[{$response.poll_response_id}]" class="input">
										<option value="">Не ранжировано</option>
										<option value="1" {xf:if '$currentRank == 1', 'selected="selected"'}>1</option>
										<option value="2" {xf:if '$currentRank == 2', 'selected="selected"'}>2</option>
										<option value="3" {xf:if '$currentRank == 3', 'selected="selected"'}>3</option>
										<option value="4" {xf:if '$currentRank == 4', 'selected="selected"'}>4</option>
										<option value="5" {xf:if '$currentRank == 5', 'selected="selected"'}>5</option>
										<option value="6" {xf:if '$currentRank == 6', 'selected="selected"'}>6</option>
										<option value="7" {xf:if '$currentRank == 7', 'selected="selected"'}>7</option>
										<option value="8" {xf:if '$currentRank == 8', 'selected="selected"'}>8</option>
										<option value="9" {xf:if '$currentRank == 9', 'selected="selected"'}>9</option>
										<option value="10" {xf:if '$currentRank == 10', 'selected="selected"'}>10</option>
										<option value="11" {xf:if '$currentRank == 11', 'selected="selected"'}>11</option>
										<option value="12" {xf:if '$currentRank == 12', 'selected="selected"'}>12</option>
										<option value="13" {xf:if '$currentRank == 13', 'selected="selected"'}>13</option>
										<option value="14" {xf:if '$currentRank == 14', 'selected="selected"'}>14</option>
										<option value="15" {xf:if '$currentRank == 15', 'selected="selected"'}>15</option>
									</select>
								</dd>
							</dl>
						</xf:foreach>
					</div>

					<div class="block-footer">
						<span class="block-footer-controls">
							<xf:button type="submit" class="button--primary" icon="vote">
								{{ phrase('cast_vote') }}
							</xf:button>
						</span>
					</div>

					<xf:hiddenval name="_xfToken" value="{{ csrf_token() }}" />
				</form>

			<xf:else />
				<div class="blockMessage blockMessage--important">
					{{ phrase('do_not_have_permission_to_vote') }}
				</div>
			</xf:if>

			<!-- View Results Button -->
			<xf:if is="$poll.canViewRankedResults()">
				<div class="block-footer block-footer--split">
					<span class="block-footer-controls">
						<a href="{{ link('ranked-polls/results', $poll) }}" class="button button--link">
							<span class="button-text">
								<i class="fa fa-chart-bar" aria-hidden="true"></i>
								{{ phrase('view_results') }}
							</span>
						</a>
					</span>
				</div>
			</xf:if>

		</div>
	</div>
</div>
